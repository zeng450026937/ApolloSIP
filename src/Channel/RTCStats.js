const inbound = {
  'audio' : {
    bytesReceived : 10960,
    codecId       : 'RTCCodec_InboundAudio_111',
    codec         : {
      clockRate   : 48000,
      id          : 'RTCCodec_InboundAudio_111',
      mimeType    : 'audio/opus',
      payloadType : 111,
      timestamp   : 1523421873539,
      type        : 'codec'
    },
    fractionLost    : 0,
    id              : 'RTCInboundRTPAudioStream_9709905',
    isRemote        : false,
    jitter          : 0.002,
    mediaType       : 'audio',
    packetsLost     : 0,
    packetsReceived : 160,
    ssrc            : 9709905,
    timestamp       : 1523421873539,
    trackId         : 'RTCMediaStreamTrack_receiver_1',
    track           : {
      audioLevel           : 0.00003051850947599719,
      concealedSamples     : 10640,
      concealmentEvents    : 3,
      detached             : false,
      ended                : false,
      id                   : 'RTCMediaStreamTrack_receiver_1',
      jitterBufferDelay    : 2947.2,
      kind                 : 'audio',
      remoteSource         : true,
      timestamp            : 1523421873539,
      totalAudioEnergy     : 2.868648615560506e-9,
      totalSamplesDuration : 3.839999999999962,
      totalSamplesReceived : 164480,
      trackIdentifier      : '051d049c-3d43-11e8-a345-ade03ae6bf09',
      type                 : 'track'
    },
    transportId : 'RTCTransport_audio_1',
    transport   : {
      bytesReceived      : 12715,
      bytesSent          : 34630,
      dtlsState          : 'connected',
      id                 : 'RTCTransport_audio_1',
      localCertificateId : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
      localCertificate   : {
        base64Certificate    : 'MIIBFjCBvaADAgECAgkA4Su+dhz/rRswCgYIKoZIzj0EAwIwETEPMA0GA1UEAwwGV2ViUlRDMB4XDTE4MDQxMDA0NDQyOFoXDTE4MDUxMTA0NDQyOFowETEPMA0GA1UEAwwGV2ViUlRDMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEKmQOuQ1ZyU8GWMHmBeI53r3GNL01puuma5ZlstwYMIswzGX/3TKKSIRKe2AYAdsnUPJfh1/HGudHvKrLQYVU3DAKBggqhkjOPQQDAgNIADBFAiA7BajaOsaF1Ox5yF6CdOWKbnQCFbVCerFrhpec/+06fwIhAP24Yrf+XvOPWWs18lqKFEm+c5XomnHNEjQcrSkDoOMT',
        fingerprint          : 'DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        fingerprintAlgorithm : 'sha-256',
        id                   : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      remoteCertificateId : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
      remoteCertificate   : {
        base64Certificate    : 'MIIBqTCCARKgAwIBAgIEcYkFOjANBgkqhkiG9w0BAQUFADAZMRcwFQYDVQQDDA5kdGxzQHRyYXZlcnNhbDAeFw0xNzA0MTAwOTE3MzdaFw0yODA0MDcwOTE3MzdaMBkxFzAVBgNVBAMMDmR0bHNAdHJhdmVyc2FsMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCoI5r3smtTvhsaEqgI7qolzCpU0nY6CjZ4NMppbptXQgFdlAzJnorN6C3VdD0AsOCFyP0U64YcKo5PBhkciMupIxAw+WtuXUxoXdr3NTDoqPU7J7C4yEbdbFt4pOFRkg1NlRQnWE4qunjw++4m7LgMmrmoo+q8w2EGckcnCWjEfQIDAQABMA0GCSqGSIb3DQEBBQUAA4GBAFAKIHBleYPzxHxYWugozd8jIEyG9k0WRsrTKE5Yh82bYJqzFIl4TAd3WaGaqjZB0vyJ8agZNFqRS/Bd/tglhe4JWszJJi9p9go8cPqwNbnExWS6EY0fGBlkEzfIdckWSiiRfZ5kqpbIcnp3SIsc0e+pDqCxuu2az38dEQUBApi/',
        fingerprint          : '21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        fingerprintAlgorithm : 'sha-1',
        id                   : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      selectedCandidatePairId : 'RTCIceCandidatePair_OWXSJl47_KNOxJMMC',
      selectedCandidatePair   : {
        availableOutgoingBitrate : 352000,
        bytesReceived            : 12715,
        bytesSent                : 34630,
        consentRequestsSent      : 4,
        currentRoundTripTime     : 0.001,
        id                       : 'RTCIceCandidatePair_OWXSJl47_KNOxJMMC',
        localCandidateId         : 'RTCIceCandidate_OWXSJl47',
        nominated                : true,
        priority                 : 9115038255648080000,
        remoteCandidateId        : 'RTCIceCandidate_KNOxJMMC',
        requestsReceived         : 4,
        requestsSent             : 1,
        responsesReceived        : 5,
        responsesSent            : 4,
        state                    : 'succeeded',
        timestamp                : 1523421873539,
        totalRoundTripTime       : 0.013,
        transportId              : 'RTCTransport_audio_1',
        type                     : 'candidate-pair',
        writable                 : true
      },
      timestamp : 1523421873539,
      type      : 'transport'
    },
    type : 'inbound-rtp'
  },
  'video' : {
    bytesReceived : 251496,
    codecId       : 'RTCCodec_InboundVideo_100',
    codec         : {
      clockRate   : 90000,
      id          : 'RTCCodec_InboundVideo_100',
      mimeType    : 'video/H264',
      payloadType : 100,
      timestamp   : 1523421873539,
      type        : 'codec'
    },
    firCount        : 0,
    fractionLost    : 0,
    framesDecoded   : 94,
    id              : 'RTCInboundRTPVideoStream_2759704630',
    isRemote        : false,
    mediaType       : 'video',
    nackCount       : 0,
    packetsLost     : 0,
    packetsReceived : 276,
    pliCount        : 0,
    qpSum           : 1415,
    ssrc            : 2759704630,
    timestamp       : 1523421873539,
    trackId         : 'RTCMediaStreamTrack_receiver_0',
    track           : {
      detached        : false,
      ended           : false,
      frameHeight     : 360,
      frameWidth      : 640,
      framesDecoded   : 94,
      framesDropped   : 1,
      framesReceived  : 95,
      id              : 'RTCMediaStreamTrack_receiver_0',
      kind            : 'video',
      remoteSource    : true,
      timestamp       : 1523421873539,
      trackIdentifier : '051d0528-3d43-11e8-a346-ade03ae6bf09',
      type            : 'track'
    },
    transportId : 'RTCTransport_video_1',
    transport   : {
      bytesReceived      : 253780,
      bytesSent          : 32935,
      dtlsState          : 'connected',
      id                 : 'RTCTransport_video_1',
      localCertificateId : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
      localCertificate   : {
        base64Certificate    : 'MIIBFjCBvaADAgECAgkA4Su+dhz/rRswCgYIKoZIzj0EAwIwETEPMA0GA1UEAwwGV2ViUlRDMB4XDTE4MDQxMDA0NDQyOFoXDTE4MDUxMTA0NDQyOFowETEPMA0GA1UEAwwGV2ViUlRDMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEKmQOuQ1ZyU8GWMHmBeI53r3GNL01puuma5ZlstwYMIswzGX/3TKKSIRKe2AYAdsnUPJfh1/HGudHvKrLQYVU3DAKBggqhkjOPQQDAgNIADBFAiA7BajaOsaF1Ox5yF6CdOWKbnQCFbVCerFrhpec/+06fwIhAP24Yrf+XvOPWWs18lqKFEm+c5XomnHNEjQcrSkDoOMT',
        fingerprint          : 'DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        fingerprintAlgorithm : 'sha-256',
        id                   : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      remoteCertificateId : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
      remoteCertificate   : {
        base64Certificate    : 'MIIBqTCCARKgAwIBAgIEcYkFOjANBgkqhkiG9w0BAQUFADAZMRcwFQYDVQQDDA5kdGxzQHRyYXZlcnNhbDAeFw0xNzA0MTAwOTE3MzdaFw0yODA0MDcwOTE3MzdaMBkxFzAVBgNVBAMMDmR0bHNAdHJhdmVyc2FsMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCoI5r3smtTvhsaEqgI7qolzCpU0nY6CjZ4NMppbptXQgFdlAzJnorN6C3VdD0AsOCFyP0U64YcKo5PBhkciMupIxAw+WtuXUxoXdr3NTDoqPU7J7C4yEbdbFt4pOFRkg1NlRQnWE4qunjw++4m7LgMmrmoo+q8w2EGckcnCWjEfQIDAQABMA0GCSqGSIb3DQEBBQUAA4GBAFAKIHBleYPzxHxYWugozd8jIEyG9k0WRsrTKE5Yh82bYJqzFIl4TAd3WaGaqjZB0vyJ8agZNFqRS/Bd/tglhe4JWszJJi9p9go8cPqwNbnExWS6EY0fGBlkEzfIdckWSiiRfZ5kqpbIcnp3SIsc0e+pDqCxuu2az38dEQUBApi/',
        fingerprint          : '21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        fingerprintAlgorithm : 'sha-1',
        id                   : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      selectedCandidatePairId : 'RTCIceCandidatePair_UloNwlx8_JTakVsvz',
      selectedCandidatePair   : {
        availableOutgoingBitrate : 352000,
        bytesReceived            : 253780,
        bytesSent                : 32935,
        consentRequestsSent      : 4,
        currentRoundTripTime     : 0.001,
        id                       : 'RTCIceCandidatePair_UloNwlx8_JTakVsvz',
        localCandidateId         : 'RTCIceCandidate_UloNwlx8',
        nominated                : true,
        priority                 : 9115038255648080000,
        remoteCandidateId        : 'RTCIceCandidate_JTakVsvz',
        requestsReceived         : 4,
        requestsSent             : 1,
        responsesReceived        : 5,
        responsesSent            : 4,
        state                    : 'succeeded',
        timestamp                : 1523421873539,
        totalRoundTripTime       : 0.013,
        transportId              : 'RTCTransport_video_1',
        type                     : 'candidate-pair',
        writable                 : true
      },
      timestamp : 1523421873539,
      type      : 'transport'
    },
    type : 'inbound-rtp'
  }
};

const outbound = {
  'audio' : {
    bytesSent : 32428,
    codecId   : 'RTCCodec_OutboundAudio_111',
    codec     : {
      clockRate   : 48000,
      id          : 'RTCCodec_OutboundAudio_111',
      mimeType    : 'audio/opus',
      payloadType : 111,
      timestamp   : 1523421873539,
      type        : 'codec'
    },
    id          : 'RTCOutboundRTPAudioStream_52341414',
    isRemote    : false,
    mediaType   : 'audio',
    packetsSent : 187,
    ssrc        : 52341414,
    timestamp   : 1523421873539,
    trackId     : 'RTCMediaStreamTrack_sender_1',
    track       : {
      audioLevel           : 0,
      detached             : false,
      ended                : false,
      id                   : 'RTCMediaStreamTrack_sender_1',
      kind                 : 'audio',
      remoteSource         : false,
      timestamp            : 1523421873539,
      totalAudioEnergy     : 0,
      totalSamplesDuration : 0,
      trackIdentifier      : '0055a48d-656a-4ac3-859e-6b896fce7150',
      type                 : 'track'
    },
    transportId : 'RTCTransport_audio_1',
    transport   : {
      bytesReceived      : 12715,
      bytesSent          : 34630,
      dtlsState          : 'connected',
      id                 : 'RTCTransport_audio_1',
      localCertificateId : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
      localCertificate   : {
        base64Certificate    : 'MIIBFjCBvaADAgECAgkA4Su+dhz/rRswCgYIKoZIzj0EAwIwETEPMA0GA1UEAwwGV2ViUlRDMB4XDTE4MDQxMDA0NDQyOFoXDTE4MDUxMTA0NDQyOFowETEPMA0GA1UEAwwGV2ViUlRDMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEKmQOuQ1ZyU8GWMHmBeI53r3GNL01puuma5ZlstwYMIswzGX/3TKKSIRKe2AYAdsnUPJfh1/HGudHvKrLQYVU3DAKBggqhkjOPQQDAgNIADBFAiA7BajaOsaF1Ox5yF6CdOWKbnQCFbVCerFrhpec/+06fwIhAP24Yrf+XvOPWWs18lqKFEm+c5XomnHNEjQcrSkDoOMT',
        fingerprint          : 'DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        fingerprintAlgorithm : 'sha-256',
        id                   : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      remoteCertificateId : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
      remoteCertificate   : {
        base64Certificate    : 'MIIBqTCCARKgAwIBAgIEcYkFOjANBgkqhkiG9w0BAQUFADAZMRcwFQYDVQQDDA5kdGxzQHRyYXZlcnNhbDAeFw0xNzA0MTAwOTE3MzdaFw0yODA0MDcwOTE3MzdaMBkxFzAVBgNVBAMMDmR0bHNAdHJhdmVyc2FsMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCoI5r3smtTvhsaEqgI7qolzCpU0nY6CjZ4NMppbptXQgFdlAzJnorN6C3VdD0AsOCFyP0U64YcKo5PBhkciMupIxAw+WtuXUxoXdr3NTDoqPU7J7C4yEbdbFt4pOFRkg1NlRQnWE4qunjw++4m7LgMmrmoo+q8w2EGckcnCWjEfQIDAQABMA0GCSqGSIb3DQEBBQUAA4GBAFAKIHBleYPzxHxYWugozd8jIEyG9k0WRsrTKE5Yh82bYJqzFIl4TAd3WaGaqjZB0vyJ8agZNFqRS/Bd/tglhe4JWszJJi9p9go8cPqwNbnExWS6EY0fGBlkEzfIdckWSiiRfZ5kqpbIcnp3SIsc0e+pDqCxuu2az38dEQUBApi/',
        fingerprint          : '21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        fingerprintAlgorithm : 'sha-1',
        id                   : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      selectedCandidatePairId : 'RTCIceCandidatePair_OWXSJl47_KNOxJMMC',
      selectedCandidatePair   : {
        availableOutgoingBitrate : 352000,
        bytesReceived            : 12715,
        bytesSent                : 34630,
        consentRequestsSent      : 4,
        currentRoundTripTime     : 0.001,
        id                       : 'RTCIceCandidatePair_OWXSJl47_KNOxJMMC',
        localCandidateId         : 'RTCIceCandidate_OWXSJl47',
        nominated                : true,
        priority                 : 9115038255648080000,
        remoteCandidateId        : 'RTCIceCandidate_KNOxJMMC',
        requestsReceived         : 4,
        requestsSent             : 1,
        responsesReceived        : 5,
        responsesSent            : 4,
        state                    : 'succeeded',
        timestamp                : 1523421873539,
        totalRoundTripTime       : 0.013,
        transportId              : 'RTCTransport_audio_1',
        type                     : 'candidate-pair',
        writable                 : true
      },
      timestamp : 1523421873539,
      type      : 'transport'
    },
    type : 'inbound-rtp'
  },
  'video' : {
    bytesSent : 30774,
    codecId   : 'RTCCodec_OutboundVideo_97',
    codec     : {
      clockRate   : 90000,
      id          : 'RTCCodec_OutboundVideo_97',
      mimeType    : 'video/H264',
      payloadType : 97,
      timestamp   : 1523421873539,
      type        : 'codec'
    },
    firCount      : 1,
    framesDecoded : 50,
    id            : 'RTCOutboundRTPVideoStream_3652939144',
    isRemote      : false,
    mediaType     : 'video',
    nackCount     : 0,
    packetsSent   : 96,
    pliCount      : 0,
    qpSum         : 857,
    ssrc          : 3652939144,
    timestamp     : 1523421873539,
    trackId       : 'RTCMediaStreamTrack_sender_2',
    track         : {
      detached        : false,
      ended           : false,
      frameHeight     : 360,
      frameWidth      : 640,
      framesSent      : 50,
      id              : 'RTCMediaStreamTrack_sender_2',
      kind            : 'video',
      remoteSource    : false,
      timestamp       : 1523421873539,
      trackIdentifier : 'efa59886-ee99-4ecc-92fa-13bce59d01fa',
      type            : 'track'
    },
    transportId : 'RTCTransport_video_1',
    transport   : {
      bytesReceived      : 253780,
      bytesSent          : 32935,
      dtlsState          : 'connected',
      id                 : 'RTCTransport_video_1',
      localCertificateId : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
      localCertificate   : {
        base64Certificate    : 'MIIBFjCBvaADAgECAgkA4Su+dhz/rRswCgYIKoZIzj0EAwIwETEPMA0GA1UEAwwGV2ViUlRDMB4XDTE4MDQxMDA0NDQyOFoXDTE4MDUxMTA0NDQyOFowETEPMA0GA1UEAwwGV2ViUlRDMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEKmQOuQ1ZyU8GWMHmBeI53r3GNL01puuma5ZlstwYMIswzGX/3TKKSIRKe2AYAdsnUPJfh1/HGudHvKrLQYVU3DAKBggqhkjOPQQDAgNIADBFAiA7BajaOsaF1Ox5yF6CdOWKbnQCFbVCerFrhpec/+06fwIhAP24Yrf+XvOPWWs18lqKFEm+c5XomnHNEjQcrSkDoOMT',
        fingerprint          : 'DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        fingerprintAlgorithm : 'sha-256',
        id                   : 'RTCCertificate_DB:32:C4:ED:4C:F0:9B:6C:56:5A:D7:93:A8:F5:C0:35:9E:B6:5D:0C:54:41:19:EE:8E:38:FA:32:18:D7:CA:06',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      remoteCertificateId : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
      remoteCertificate   : {
        base64Certificate    : 'MIIBqTCCARKgAwIBAgIEcYkFOjANBgkqhkiG9w0BAQUFADAZMRcwFQYDVQQDDA5kdGxzQHRyYXZlcnNhbDAeFw0xNzA0MTAwOTE3MzdaFw0yODA0MDcwOTE3MzdaMBkxFzAVBgNVBAMMDmR0bHNAdHJhdmVyc2FsMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCoI5r3smtTvhsaEqgI7qolzCpU0nY6CjZ4NMppbptXQgFdlAzJnorN6C3VdD0AsOCFyP0U64YcKo5PBhkciMupIxAw+WtuXUxoXdr3NTDoqPU7J7C4yEbdbFt4pOFRkg1NlRQnWE4qunjw++4m7LgMmrmoo+q8w2EGckcnCWjEfQIDAQABMA0GCSqGSIb3DQEBBQUAA4GBAFAKIHBleYPzxHxYWugozd8jIEyG9k0WRsrTKE5Yh82bYJqzFIl4TAd3WaGaqjZB0vyJ8agZNFqRS/Bd/tglhe4JWszJJi9p9go8cPqwNbnExWS6EY0fGBlkEzfIdckWSiiRfZ5kqpbIcnp3SIsc0e+pDqCxuu2az38dEQUBApi/',
        fingerprint          : '21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        fingerprintAlgorithm : 'sha-1',
        id                   : 'RTCCertificate_21:D2:2D:B2:F6:E1:E4:2A:F8:34:75:5A:4F:AD:0D:01:B3:B9:02:48',
        timestamp            : 1523421872541,
        type                 : 'certificate'
      },
      selectedCandidatePairId : 'RTCIceCandidatePair_UloNwlx8_JTakVsvz',
      selectedCandidatePair   : {
        availableOutgoingBitrate : 352000,
        bytesReceived            : 253780,
        bytesSent                : 32935,
        consentRequestsSent      : 4,
        currentRoundTripTime     : 0.001,
        id                       : 'RTCIceCandidatePair_UloNwlx8_JTakVsvz',
        localCandidateId         : 'RTCIceCandidate_UloNwlx8',
        nominated                : true,
        priority                 : 9115038255648080000,
        remoteCandidateId        : 'RTCIceCandidate_JTakVsvz',
        requestsReceived         : 4,
        requestsSent             : 1,
        responsesReceived        : 5,
        responsesSent            : 4,
        state                    : 'succeeded',
        timestamp                : 1523421873539,
        totalRoundTripTime       : 0.013,
        transportId              : 'RTCTransport_video_1',
        type                     : 'candidate-pair',
        writable                 : true
      },
      timestamp : 1523421873539,
      type      : 'transport'
    },
    type : 'inbound-rtp'
  }
};

const SIP = require('../Base/SIP');
const debug = SIP.debug('Apollo:MediaChannel');

module.exports = class RTCStats
{
  constructor()
  {
    this._quality = -1;
    this._inbound = {};
    this._outbound = {};
  }

  get quality()
  {
    return this._quality;
  }

  get inbound()
  {
    return this._inbound;
  }

  get outbound()
  {
    return this._outbound;
  }

  clear()
  {
    this._quality = -1;
    this._inbound = {};
    this._outbound = {};
  }

  update(report)
  {
    report.forEach((stats) => 
    {
      switch (stats.type)
      {
        case 'codec':
          break;
        case 'inbound-rtp':
          this._updateRTPStats(report, stats, 'inbound');
          break;
        case 'outbound-rtp':
          this._updateRTPStats(report, stats, 'outbound');
          break;
        case 'remote-inbound-rtp':
          break;
        case 'remote-outbound-rtp':
          break;
        case 'csrc':
          break;
        case 'peer-connection':
          break;
        case 'data-channel':
          break;
        case 'stream':
          break;
        case 'track':
          break;
        case 'sender':
          break;
        case 'receiver':
          break;
        case 'transport':
          break;
        case 'candidate-pair':
          break;
        case 'local-candidate':
          break;
        case 'remote-candidate':
          break;
        case 'certificate':
          break;
      }
    });

    let totalPacketsLostRate = 0;
    let totalChannel = 0;

    if (this.inbound.audio)
    {
      totalChannel++;
      totalPacketsLostRate += this.inbound.audio.packetsLostRate;
    }
    if (this.inbound.video)
    {
      totalChannel++;
      totalPacketsLostRate += this.inbound.video.packetsLostRate;
    }

    if (totalChannel)
    {
      const average = totalPacketsLostRate / totalChannel;
      
      this._quality = 
        average>=12?0:
          average>=5?1:
            average>=3?2:
              average>=2?3:
                4;
    }
  }

  _parseRTPStats(report, stats)
  {
    const codec = report.get(stats.codecId);
    const track = report.get(stats.trackId);
    const transport = report.get(stats.transportId);

    if (codec)
    {
      codec.name = codec.mimeType.split('/')[1];
    }

    if (transport)
    {
      const localCertificate = report.get(transport.localCertificateId);
      const remoteCertificate = report.get(transport.remoteCertificateId);
      const selectedCandidatePair = report.get(transport.selectedCandidatePairId);

      transport.localCertificate = localCertificate;
      transport.remoteCertificate = remoteCertificate;
      transport.selectedCandidatePair = selectedCandidatePair;
    }

    stats.codec = codec;
    stats.track = track;
    stats.transport = transport;

    return stats;
  }

  _updateRTPStats(report, stats, direction)
  {
    // ignore rtcp in firefox
    if (stats.isRemote === false)
    {
      stats = this._parseRTPStats(report, stats);

      // calc packetsLostRate
      if (direction === 'inbound' && !stats.packetsLostRate)
      {
        const totalPackets = stats.packetsLost + stats.packetsReceived;
    
        stats.packetsLostRate = totalPackets===0?0:(stats.packetsLost / totalPackets);
      }

      const prestats = this[direction][stats.mediaType];

      if (prestats)
      {
        const time_diff = diff(stats, prestats, 'timestamp');
        let value_diff;

        // calc outgoingBitrate
        if (direction==='outbound' && !stats.outgoingBitrate)
        {
          value_diff = diff(stats, prestats, 'bytesSent');
      
          stats.outgoingBitrate = value_diff * 8 / time_diff;
        }
        // calc incomingBitrate
        if (direction==='inbound' && !stats.incomingBitrate)
        {
          value_diff = diff(stats, prestats, 'bytesReceived');
      
          stats.incomingBitrate = value_diff * 8 / time_diff;
        }

        // calc transport outgoingBitrate
        if (stats.transport && !stats.transport.outgoingBitrate)
        {
          value_diff = diff(stats.transport, prestats.transport, 'bytesSent');

          stats.transport.outgoingBitrate = value_diff * 8 / time_diff;
        }
        // calc transport incomingBitrate
        if (stats.transport && !stats.transport.incomingBitrate)
        {
          value_diff = diff(stats.transport, prestats.transport, 'bytesReceived');

          stats.transport.incomingBitrate = value_diff * 8 / time_diff;
        }

        // calc frameRate
        if (stats.mediaType === 'video' && stats.track && !stats.track.frameRate)
        {
          if (direction === 'inbound')
          {
            value_diff = diff(stats.track, prestats.track, 'framesReceived');
          }
          if (direction === 'outbound')
          {
            value_diff = diff(stats.track, prestats.track, 'framesSent');
          }

          stats.track.frameRate = value_diff / time_diff * 1000;
        }
      }
        
      this[direction][stats.mediaType] = stats;
    }

    function diff(x, y, key)
    {
      if (x[key] && y[key])
      {
        return Math.abs(x[key] - y[key]);
      }
      
      return 0;
    }
  }
};